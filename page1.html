<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NewsAI — Instant News Check</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <style>
    :root{
      --bg:#0a0b12;
      --surface:#121427;
      --panel:#171a33;
      --glass:rgba(255,255,255,0.06);
      --border:rgba(255,255,255,0.12);
      --text:#ecf1ff;
      --muted:#9aa4c7;
      --accent:#7C4DFF;
      --accent-2:#00F5D4;
      --success:#00E0A4;
      --warn:#FFC857;
      --danger:#FF5A7A;
      --chip:#21254a;
      --shadow:0 30px 90px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(124,77,255,.12), transparent),
        radial-gradient(900px 600px at 90% 10%, rgba(0,245,212,.10), transparent),
        radial-gradient(900px 600px at 50% 120%, rgba(255,90,122,.10), transparent),
        var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    /* Navbar */
    .nav{
      position:sticky; top:0; z-index:100;
      background:rgba(10,11,18,.75); backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border);
    }
    .nav-inner{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .brand-logo{
      width:40px;height:40px;display:grid;place-items:center;border-radius:12px;
      background: radial-gradient(100px 60px at 30% 30%, rgba(124,77,255,.45), transparent),
                  radial-gradient(120px 80px at 70% 70%, rgba(0,245,212,.45), transparent);
      border:1px solid var(--border);
      box-shadow: inset 0 0 18px rgba(124,77,255,.25);
      color:#fff;
    }
    .brand-name{
      font-family:"Space Grotesk",Inter,sans-serif; font-weight:700; letter-spacing:.2px;
    }
    .menu{display:flex;align-items:center;gap:18px}
    .menu a, .menu button{
      color:var(--text); background:none; border:none; font:inherit; cursor:pointer;
      padding:8px 10px; border-radius:10px;
    }
    .menu a:hover, .menu button:hover{background:var(--glass)}
    .cta{
      background:linear-gradient(135deg,var(--accent),#9a78ff);
      color:#0f1022; font-weight:700; padding:10px 14px; border-radius:12px;
      box-shadow:0 14px 32px rgba(124,77,255,.35), inset 0 -6px 12px rgba(0,0,0,.25);
    }
    .dropdown{position:relative}
    .drop-list{
      position:absolute; top:45px; left:0; min-width:280px; padding:10px;
      background:var(--surface); border:1px solid var(--border); border-radius:12px;
      box-shadow:var(--shadow); display:none;
    }
    .dropdown:hover .drop-list{display:block}
    .drop-item{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;color:var(--muted)}
    .drop-item:hover{background:var(--panel);color:var(--text)}
    .drop-item i{color:var(--accent)}

    /* Hero */
    .hero{padding:48px 0 10px}
    .hero-grid{display:grid;grid-template-columns:1.1fr .9fr;gap:24px}
    .hero-card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border); border-radius:20px; padding:26px; box-shadow:var(--shadow);
    }
    .eyebrow{color:var(--muted);text-transform:uppercase;letter-spacing:.22em;font-size:12px}
    .headline{
      font-family:"Space Grotesk",Inter,sans-serif; font-weight:700;
      font-size:clamp(28px,4vw,44px); line-height:1.1; margin:10px 0 8px;
    }
    .sub{color:var(--muted); margin-bottom:16px}
    .badges{display:flex;gap:10px;flex-wrap:wrap}
    .chip{
      background:var(--chip); border:1px solid var(--border); color:var(--muted);
      padding:8px 12px; border-radius:999px; display:inline-flex; align-items:center; gap:8px;
      font-size:13px;
    }
    .chip i{color:var(--accent)}

    .hero-visual{
      position:relative; min-height:260px; border:1px solid var(--border);
      border-radius:20px; overflow:hidden; background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }
    .orb{position:absolute; border-radius:50%; filter:blur(16px); mix-blend-mode:screen; opacity:.75; animation:float 14s ease-in-out infinite}
    .orb.v1{width:260px;height:260px;background:radial-gradient(circle at 30% 30%, rgba(124,77,255,.6), transparent 60%); top:-60px; left:-60px}
    .orb.v2{width:210px;height:210px;background:radial-gradient(circle at 70% 70%, rgba(0,245,212,.6), transparent 60%); bottom:-40px; right:-40px; animation-duration:18s}
    .orb.v3{width:150px;height:150px;background:radial-gradient(circle at 50% 50%, rgba(255,90,122,.6), transparent 60%); top:40%; left:50%; transform:translate(-50%,-50%); animation-duration:22s}
    @keyframes float{0%{transform:translateY(0) scale(1)}50%{transform:translateY(-12px) scale(1.05)}100%{transform:translateY(0) scale(1)}}

    /* Product demo */
    .demo{margin:26px 0 0; display:grid; grid-template-columns:1.1fr .9fr; gap:24px}
    .card{background:var(--surface); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow)}
    .card .head{padding:16px 18px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px}
    .card .head i{color:var(--accent)}
    .card .body{padding:18px}

    .tabs{display:flex; gap:8px; margin-bottom:14px}
    .tab{padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:var(--panel); color:var(--muted); cursor:pointer}
    .tab.active{background:linear-gradient(135deg,var(--accent),#9a78ff); color:#0e1022; font-weight:700}
    textarea,input[type=text]{width:100%; background:rgba(255,255,255,.04); border:1px solid var(--border); color:var(--text); border-radius:12px; padding:12px; outline:none}
    .dropzone{
      border:1.5px dashed var(--border); border-radius:14px; padding:18px; text-align:center; color:var(--muted); background:rgba(255,255,255,.03); cursor:pointer
    }
    .dz-hint{font-size:12px;color:var(--muted); margin-top:8px}
    .actions{display:flex; gap:10px; margin-top:14px}
    .btn{
      display:inline-flex; align-items:center; gap:8px; padding:12px 14px; border-radius:12px; border:1px solid var(--border); cursor:pointer;
      background:linear-gradient(135deg,var(--accent),#9a78ff); color:#0e1022; font-weight:700; box-shadow:0 12px 28px rgba(124,77,255,.32), inset 0 -6px 12px rgba(0,0,0,.25)
    }
    .btn.secondary{background:transparent;color:var(--text)}
    .hint{color:var(--muted); font-size:13px; margin-top:8px}

    /* Results */
    .result-status{display:flex; align-items:center; gap:10px; margin-bottom:10px}
    .badge{
      padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px;
    }
    .ok{background:rgba(0,224,164,.18); color:#00e0a4; border:1px solid rgba(0,224,164,.35)}
    .warn{background:rgba(255,200,87,.18); color:#ffc857; border:1px solid rgba(255,200,87,.35)}
    .bad{background:rgba(255,90,122,.18); color:#ff5a7a; border:1px solid rgba(255,90,122,.35)}
    .score{margin-top:6px}
    .meter{height:10px; background:#1b1f3d; border-radius:999px; overflow:hidden; border:1px solid var(--border)}
    .bar{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px}
    .tag{background:var(--chip); border:1px solid var(--border); padding:8px 10px; border-radius:999px; color:var(--muted); font-size:13px; display:inline-flex; gap:8px; align-items:center}
    .tag i{color:var(--accent)}
    .ctx{margin-top:14px; color:var(--muted); font-size:14px}

    /* XAI Section */
    .xai-section {
      margin-top: 16px;
      padding: 14px;
      background: rgba(124, 77, 255, 0.08);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .xai-title {
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .xai-item {
      margin: 8px 0;
      padding: 8px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    .xai-label {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }
    .xai-value {
      color: var(--muted);
      font-size: 13px;
    }
    .xai-factors {
      list-style: none;
      padding-left: 0;
      margin: 4px 0;
    }
    .xai-factors li {
      padding: 4px 0;
      color: var(--muted);
      font-size: 13px;
    }
    .xai-factors li:before {
      content: "✓ ";
      color: var(--success);
      margin-right: 6px;
    }

    /* Use-cases */
    .section{margin:38px 0}
    .section .title{display:flex; align-items:center; gap:10px; margin-bottom:14px; font-weight:700}
    .section .title i{color:var(--accent)}
    .case-grid{display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px}
    .case{background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:16px}
    .case h4{margin:8px 0 6px; font-weight:700}
    .case p{margin:0; color:var(--muted); font-size:14px}

    /* Footer */
    footer{margin:40px 0 24px; color:var(--muted); border-top:1px solid var(--border); padding-top:18px; font-size:14px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .foot-links{display:flex; gap:16px; flex-wrap:wrap}
    .foot-links a{color:var(--muted)}
    @media (max-width: 1000px){
      .hero-grid, .demo{grid-template-columns:1fr}
      .case-grid{grid-template-columns:1fr}
    }
    /* Animated XAI reveal */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.xai-item {
  margin: 8px 0;
  padding: 8px;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  opacity: 0;
  animation: slideInUp 0.5s ease-out forwards;
}

.xai-item:nth-child(1) { animation-delay: 0.2s; }
.xai-item:nth-child(2) { animation-delay: 0.4s; }
.xai-item:nth-child(3) { animation-delay: 0.6s; }
.xai-item:nth-child(4) { animation-delay: 0.8s; }
.xai-item:nth-child(5) { animation-delay: 1.0s; }

.xai-factors li {
  opacity: 0;
  animation: slideInUp 0.3s ease-out forwards;
}

.xai-factors li:nth-child(1) { animation-delay: 0.9s; }
.xai-factors li:nth-child(2) { animation-delay: 1.0s; }
.xai-factors li:nth-child(3) { animation-delay: 1.1s; }

  </style>
</head>
<body>
  <!-- Navbar -->
  <div class="nav">
    <div class="container nav-inner">
      <a href="#" class="brand">
        <div class="brand-logo"><i class="fa-solid fa-brain"></i></div>
        <div class="brand-name">NewsAI</div>
      </a>
      <nav class="menu">
        <div class="dropdown">
          <button>Models <i class="fa-solid fa-angle-down" style="margin-left:6px"></i></button>
          <div class="drop-list">
            <a class="drop-item" href="#news-check"><i class="fa-solid fa-shield-halved"></i> News Check</a>
            <a class="drop-item" href="#model-news-reader"><i class="fa-solid fa-user-astronaut"></i> Avatar: News Reader</a>
            <a class="drop-item" href="#model-tone-detector"><i class="fa-solid fa-wave-square"></i> News Tone Detector</a>
            <a class="drop-item" href="#model-thumbnail"><i class="fa-solid fa-image"></i> Thumbnail News</a>
            <a class="drop-item" href="#model-age"><i class="fa-solid fa-child-reaching"></i> News Age Detector</a>
            <a class="drop-item" href="#model-summarizer"><i class="fa-solid fa-list-check"></i> News Summarizer</a>
            <a class="drop-item" href="#model-recommender"><i class="fa-solid fa-compass"></i> Personalized Recommender</a>
            <a class="drop-item" href="#model-translate"><i class="fa-solid fa-language"></i> Multilingual Translation</a>
            <a class="drop-item" href="#model-filter"><i class="fa-solid fa-shield"></i> News Filter</a>
            <a class="drop-item" href="#model-history"><i class="fa-solid fa-timeline"></i> News History</a>
            <a class="drop-item" href="#model-anti-prop"><i class="fa-solid fa-ban"></i> Anti-Propaganda</a>
            <a class="drop-item" href="#model-reality-game"><i class="fa-solid fa-gamepad"></i> Reality Game</a>
            <a class="drop-item" href="#model-deep-relevance"><i class="fa-solid fa-heart-pulse"></i> Deep Relevance</a>
          </div>
        </div>
        <a href="#use-cases">Use cases</a>
        <a href="#demo">Try it</a>
        <a href="#pricing">Pricing</a>
        <a href="#signin" class="secondary">Sign in</a>
        <a href="#get-started" class="cta">Get the App</a>
      </nav>
    </div>
  </div>

  <main id="news-check" class="container">
    <!-- Hero -->
    <section class="hero">
      <div class="hero-grid">
        <div class="hero-card">
          <div class="eyebrow">Instant · Private · Multilingual</div>
          <h1 class="headline">Check news in seconds — paste a headline or drop a screenshot</h1>
          <p class="sub">No setup, no technical steps. A clear verdict, credibility score, and plain-language context you can trust.</p>
          <div class="badges">
            <div class="chip"><i class="fa-solid fa-bolt"></i> Under 2s</div>
            <div class="chip"><i class="fa-solid fa-globe"></i> 12 languages</div>
            <div class="chip"><i class="fa-solid fa-user-shield"></i> Private by design</div>
            <div class="chip"><i class="fa-solid fa-trophy"></i> High accuracy</div>
          </div>
        </div>
        <div class="hero-visual">
          <div class="orb v1"></div>
          <div class="orb v2"></div>
          <div class="orb v3"></div>
        </div>
      </div>
    </section>

    <!-- Product Demo -->
    <section id="demo" class="demo">
      <!-- Input -->
      <div class="card">
        <div class="head"><i class="fa-solid fa-diagram-project"></i> News Check</div>
        <div class="body">
          <div class="tabs">
            <button class="tab active" id="tabText"><i class="fa-regular fa-keyboard"></i> Text</button>
            <button class="tab" id="tabImage"><i class="fa-regular fa-image"></i> Image</button>
          </div>
          <div id="textInput">
            <input type="text" id="headline" placeholder="Paste a headline or short paragraph (e.g., 'Team X signs star striker for record fee')" />
            <div class="hint">Tip: Try one of these — "Government announces new fuel subsidy", "Club Y fires head coach after derby loss", "New phone model leaks benchmark scores".</div>
          </div>
          <div id="imageInput" style="display:none">
            <div class="dropzone" id="dz"><i class="fa-solid fa-cloud-arrow-up"></i> Drop a screenshot or click to upload</div>
            <div class="dz-hint">Accepts PNG/JPG. Blurred sensitive info is okay.</div>
          </div>
          <div class="actions">
            <button class="btn" id="checkBtn"><i class="fa-solid fa-magnifying-glass"></i> Check now</button>
            <button class="btn secondary" id="clearBtn"><i class="fa-regular fa-circle-xmark"></i> Clear</button>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div class="card">
        <div class="head"><i class="fa-solid fa-square-poll-vertical"></i> Result</div>
        <div class="body" id="resultBox">
          <div class="result-status">
            <span class="badge ok" id="verdictBadge">Ready</span>
            <strong id="verdictText">Paste text or upload an image to get a verdict.</strong>
          </div>
          <div class="score">
            <div style="display:flex; justify-content:space-between; font-size:13px; color:var(--muted); margin-bottom:6px;">
              <span>Credibility score</span><span id="scoreLabel">—</span>
            </div>
            <div class="meter"><div class="bar" id="scoreBar"></div></div>
          </div>
          <div class="grid">
            
          </div>
          <div class="ctx" id="contextText">A short, human-friendly explanation appears here to make the verdict easy to act on.</div>
          
          <!-- XAI Explanation Section -->
          <div class="xai-section" id="xaiSection" style="display:none;">
            <div class="xai-title">
              <i class="fa-solid fa-brain"></i> Explainable AI Breakdown
            </div>
            <div class="xai-item">
              <div class="xai-label">Claims Extracted</div>
              <div class="xai-value" id="xaiClaims">—</div>
            </div>
            <div class="xai-item">
              <div class="xai-label">Source Evaluation</div>
              <div class="xai-value" id="xaiSourceEval">—</div>
              <ul class="xai-factors" id="xaiFactors"></ul>
            </div>
            <div class="xai-item">
              <div class="xai-label">Evidence Quality</div>
              <div class="xai-value" id="xaiEvidence">—</div>
            </div>
            <div class="xai-item">
              <div class="xai-label">Final Calculation</div>
              <div class="xai-value" id="xaiCalculation">—</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Use Cases -->
    <section id="use-cases" class="section">
      <div class="title"><i class="fa-solid fa-sparkles"></i> Use case scenarios</div>
      <div class="case-grid">
        <div class="case">
          <div class="chip"><i class="fa-solid fa-mobile-screen-button"></i> On the go</div>
          <h4>Before sharing a post</h4>
          <p>Paste the headline or drop a screenshot, get a simple verdict and a confidence score to avoid spreading misleading content.</p>
        </div>
        <div class="case">
          <div class="chip"><i class="fa-solid fa-futbol"></i> Match day</div>
          <h4>Sports transfer rumors</h4>
          <p>See if a claim about a transfer, injury, or lineup is likely true, mixed, or false — with a quick score and context you can trust.</p>
        </div>
        <div class="case">
          <div class="chip"><i class="fa-solid fa-briefcase"></i> Work & study</div>
          <h4>Quick credibility checks</h4>
          <p>Validate a headline while writing reports or assignments, then cite the outcome with clear, concise wording.</p>
        </div>
      </div>
    </section>

    <!-- Benefits -->
    <section class="section">
      <div class="title"><i class="fa-solid fa-circle-check"></i> Why people love it</div>
      <div class="case-grid">
        <div class="case">
          <h4>Clarity first</h4>
          <p>Crystal-clear verdicts: True, Mixed, or False — plus a numeric score for quick decisions.</p>
        </div>
        <div class="case">
          <h4>Privacy built-in</h4>
          <p>Checks are designed to minimize retention and keep sensitive content out of long-term storage.</p>
        </div>
        <div class="case">
          <h4>Multilingual</h4>
          <p>Works across major languages so international stories are just as easy to validate.</p>
        </div>
      </div>
    </section>

    <!-- Placeholder anchors for other models -->
    <div id="model-news-reader"></div>
    <div id="model-tone-detector"></div>
    <div id="model-thumbnail"></div>
    <div id="model-age"></div>
    <div id="model-summarizer"></div>
    <div id="model-recommender"></div>
    <div id="model-translate"></div>
    <div id="model-filter"></div>
    <div id="model-history"></div>
    <div id="model-anti-prop"></div>
    <div id="model-reality-game"></div>
    <div id="model-deep-relevance"></div>

    <!-- Pricing placeholder -->
    <div id="pricing" class="section">
      <div class="title"><i class="fa-solid fa-tags"></i> Simple pricing</div>
      <div class="case-grid">
        <div class="case">
          <h4>Starter</h4>
          <p>Perfect for everyday checks with fair usage limits and core features included.</p>
        </div>
        <div class="case">
          <h4>Pro</h4>
          <p>For power users who need faster checks, higher limits, and priority processing.</p>
        </div>
        <div class="case">
          <h4>Teams</h4>
          <p>Collaboration features and centralized billing for groups and organizations.</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="container">
    <div>© 2025 NewsAI — Instant News Checking</div>
    <div class="foot-links">
      <a href="#news-check">News Check</a>
      <a href="#model-summarizer">Summarizer</a>
      <a href="#model-recommender">Recommender</a>
      <a href="#model-translate">Translation</a>
      <a href="#pricing">Pricing</a>
      <a href="#get-started">Get the App</a>
    </div>
  </footer>

<script>
// API Configuration
const API_BASE_URL = 'http://localhost:8000';

// Tabs
const tabText = document.getElementById('tabText');
const tabImage = document.getElementById('tabImage');
const textInput = document.getElementById('textInput');
const imageInput = document.getElementById('imageInput');

let currentFile = null;

tabText.addEventListener('click', ()=>{
  tabText.classList.add('active'); tabImage.classList.remove('active');
  textInput.style.display='block'; imageInput.style.display='none';
  currentFile = null;
});

tabImage.addEventListener('click', ()=>{
  tabImage.classList.add('active'); tabText.classList.remove('active');
  textInput.style.display='none'; imageInput.style.display='block';
});

// File upload handling
const dz = document.getElementById('dz');
const fileInput = document.createElement('input');
fileInput.type = 'file';
fileInput.accept = 'image/png,image/jpeg,image/jpg';
fileInput.style.display = 'none';
document.body.appendChild(fileInput);

dz.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', (e) => {
  if (e.target.files && e.target.files[0]) {
    currentFile = e.target.files[0];
    dz.innerHTML = `<i class="fa-solid fa-check-circle"></i> ${currentFile.name} ready`;
  }
});

// Drag and drop
dz.addEventListener('dragover', (e) => {
  e.preventDefault();
  dz.style.borderColor = 'var(--accent)';
});

dz.addEventListener('dragleave', () => {
  dz.style.borderColor = 'var(--border)';
});

dz.addEventListener('drop', (e) => {
  e.preventDefault();
  dz.style.borderColor = 'var(--border)';
  if (e.dataTransfer.files && e.dataTransfer.files[0]) {
    currentFile = e.dataTransfer.files[0];
    dz.innerHTML = `<i class="fa-solid fa-check-circle"></i> ${currentFile.name} ready`;
  }
});

// Result elements
const verdictBadge = document.getElementById('verdictBadge');
const verdictText = document.getElementById('verdictText');
const scoreBar = document.getElementById('scoreBar');
const scoreLabel = document.getElementById('scoreLabel');

const contextText = document.getElementById('contextText');

// Helper: Format score as percentage with text
function formatScore(score) {
  const percentage = Math.round(score * 20); // Convert 0-5 to 0-100
  if (percentage >= 80) return `${percentage}% (Excellent)`;
  if (percentage >= 60) return `${percentage}% (Good)`;
  if (percentage >= 40) return `${percentage}% (Fair)`;
  return `${percentage}% (Low)`;
}

// Helper: Animate score bar
function animateScoreBar(targetPercentage, duration = 2000) {
  let currentWidth = 0;
  const increment = targetPercentage / (duration / 16); // 60fps
  
  const animate = () => {
    currentWidth += increment;
    if (currentWidth >= targetPercentage) {
      scoreBar.style.width = targetPercentage + '%';
    } else {
      scoreBar.style.width = currentWidth + '%';
      requestAnimationFrame(animate);
    }
  };
  
  animate();
}

// Display results - ONLY AFTER XAI FINISHES
// Display results - ONLY AFTER XAI FINISHES
function displayResultSummary(data) {
  const verdictMap = {
    'support': { badge: 'ok', text: 'Supported', message: 'Evidence supports this claim' },
    'contradict': { badge: 'bad', text: 'Contradicted', message: 'Evidence contradicts this claim' },
    'unrelated': { badge: 'warn', text: 'Mixed', message: 'Limited or unclear evidence' }
  };

  const verdictInfo = verdictMap[data.verdict] || verdictMap['unrelated'];
  
  // XAI completes at ~6600ms (6 sections + animations)
  const XAI_COMPLETE_TIME = 6600;
  
  // Verdict badge (after XAI)
  setTimeout(() => {
    verdictBadge.className = 'badge ' + verdictInfo.badge;
    verdictBadge.textContent = verdictInfo.text;
    verdictText.textContent = verdictInfo.message;
  }, XAI_COMPLETE_TIME + 300);

  // Animate score
  setTimeout(() => {
    const score = Math.round((data.final_credibility_score / 5) * 100);
    animateScoreBar(score, 2000);
    scoreLabel.textContent = formatScore(data.final_credibility_score);
  }, XAI_COMPLETE_TIME + 700);

  // Show tags
  setTimeout(() => {
    
  }, XAI_COMPLETE_TIME + 1200);

  // Show context
  setTimeout(() => {
    contextText.textContent = data.best_evidence || 'No evidence found.';
  }, XAI_COMPLETE_TIME + 1700);
}


// Display XAI explanation FIRST with extended delays
// Display XAI explanation with proper section ordering
function displayXAI(explanation) {
  const xaiSection = document.getElementById('xaiSection');
  const xaiClaims = document.getElementById('xaiClaims');
  const xaiSourceEval = document.getElementById('xaiSourceEval');
  const xaiFactors = document.getElementById('xaiFactors');
  const xaiEvidence = document.getElementById('xaiEvidence');
  const xaiCalculation = document.getElementById('xaiCalculation');

  // Clear previous content
  xaiClaims.textContent = '';
  xaiSourceEval.textContent = '';
  xaiFactors.innerHTML = '';
  xaiEvidence.textContent = '';
  xaiCalculation.textContent = '';

  // Show XAI section immediately
  setTimeout(() => {
    xaiSection.style.display = 'block';
    xaiSection.style.opacity = '0';
    setTimeout(() => {
      xaiSection.style.transition = 'opacity 0.8s ease-in';
      xaiSection.style.opacity = '1';
    }, 100);
  }, 500);

  // 1️⃣ Claims Extracted (delay: 1000ms)
  setTimeout(() => {
    if (explanation.claim_extraction) {
      const claimsCount = explanation.claim_extraction.claims_analyzed || 1;
      const claimsText = claimsCount === 1 ? 'claim' : 'claims';
      xaiClaims.textContent = `Identified ${claimsCount} verifiable ${claimsText} from the article. These are atomic, fact-based statements that can be independently verified.`;
      
      // Add fade-in animation
      xaiClaims.parentElement.style.opacity = '0';
      setTimeout(() => {
        xaiClaims.parentElement.style.transition = 'opacity 0.6s ease-in';
        xaiClaims.parentElement.style.opacity = '1';
      }, 50);
    }
  }, 1000);

  // 2️⃣ Source Evaluation (delay: 2500ms - after Claims finishes)
  setTimeout(() => {
    if (explanation.source_credibility) {
      const source = explanation.source_credibility;
      const scoreText = formatScore(source.score);
      
      // Format explanation without raw numbers
      let evalText = source.explanation;
      if (evalText.includes('/5')) {
        evalText = evalText.replace(/\(Score:.*?\)/, '').trim();
      }
      
      xaiSourceEval.textContent = `${evalText} — Rated ${scoreText}`;
      
      // Add fade-in animation
      xaiSourceEval.parentElement.style.opacity = '0';
      setTimeout(() => {
        xaiSourceEval.parentElement.style.transition = 'opacity 0.6s ease-in';
        xaiSourceEval.parentElement.style.opacity = '1';
      }, 50);
      
      // Show contributing factors with stagger
      xaiFactors.innerHTML = '';
      if (source.contributing_factors && source.contributing_factors.length > 0) {
        source.contributing_factors.forEach((factor, index) => {
          setTimeout(() => {
            const li = document.createElement('li');
            li.textContent = factor;
            li.style.opacity = '0';
            xaiFactors.appendChild(li);
            
            // Fade in each factor
            setTimeout(() => {
              li.style.transition = 'opacity 0.4s ease-in';
              li.style.opacity = '1';
            }, 50);
          }, 500 + (index * 300)); // Stagger by 300ms each
        });
      }
    }
  }, 2500);

  // 3️⃣ Evidence Quality (delay: 4500ms - after Source finishes with factors)
  setTimeout(() => {
    if (explanation.best_evidence_selection) {
      const evidence = explanation.best_evidence_selection;
      
      // Format evidence text (remove raw score)
      let evidenceText = evidence.verdict_explanation || evidence.reason;
      evidenceText = evidenceText.replace(/Highest verdict score \(\d+\)\.?\s*/, '');
      evidenceText = evidenceText.replace(/Score:\s*\d+\/\d+/gi, '');
      
      xaiEvidence.textContent = evidenceText || 'Evidence analyzed for consistency with the claim.';
      
      // Add fade-in animation
      xaiEvidence.parentElement.style.opacity = '0';
      setTimeout(() => {
        xaiEvidence.parentElement.style.transition = 'opacity 0.6s ease-in';
        xaiEvidence.parentElement.style.opacity = '1';
      }, 50);
    }
  }, 4500);

  // 4️⃣ Final Calculation (delay: 6000ms - after Evidence finishes)
  setTimeout(() => {
    if (explanation.final_calculation) {
      const calc = explanation.final_calculation;
      
      // Format calculation text without raw numbers
      let calcText = calc.explanation;
      
      // Replace patterns like "4/5" or "(2.88/5)" with formatted text
      if (calc.breakdown) {
        const evidenceScore = calc.breakdown.evidence_quality?.score;
        const sourceScore = calc.breakdown.source_credibility?.score;
        
        if (evidenceScore !== undefined && sourceScore !== undefined) {
          const evidenceQuality = evidenceScore >= 4 ? 'Strong' : evidenceScore >= 3 ? 'Moderate' : 'Limited';
          const sourceQuality = formatScore(sourceScore);
          
          calcText = `Final credibility determined by combining ${evidenceQuality.toLowerCase()} evidence quality with ${sourceQuality.toLowerCase()} source reputation.`;
        }
      }
      
      // Fallback cleanup for any remaining raw scores
      calcText = calcText.replace(/\d+\.?\d*\/5/g, (match) => {
        const num = parseFloat(match);
        return formatScore(num).split(' ')[0]; // Just the percentage
      });
      
      xaiCalculation.textContent = calcText;
      
      // Add fade-in animation
      xaiCalculation.parentElement.style.opacity = '0';
      setTimeout(() => {
        xaiCalculation.parentElement.style.transition = 'opacity 0.6s ease-in';
        xaiCalculation.parentElement.style.opacity = '1';
      }, 50);
    }
  }, 6000);
}


// Main display function - shows XAI first, then result
function displayResult(data) {
  // Hide existing results
  verdictBadge.textContent = '...';
  verdictText.textContent = 'Analyzing...';
  scoreBar.style.width = '0%';
  scoreLabel.textContent = '—';
  
  contextText.textContent = 'Processing verification breakdown...';

  // Display XAI if available (shown first)
  if (data.explanation) {
    displayXAI(data.explanation);
  }

  // Then display result summary AFTER XAI completes
  displayResultSummary(data);
}

// API call for text verification
async function verifyText(text) {
  try {
    const response = await fetch(`${API_BASE_URL}/verify/text`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text }),
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.detail || 'Verification failed');
    }

    const data = await response.json();
    displayResult(data);
  } catch (error) {
    console.error('Error:', error);
    showError(error.message);
  }
}

// API call for image verification
async function verifyImage(file) {
  try {
    const formData = new FormData();
    formData.append('file', file);

    const response = await fetch(`${API_BASE_URL}/verify/image`, {
      method: 'POST',
      body: formData,
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.detail || 'Verification failed');
    }

    const data = await response.json();
    displayResult(data);
  } catch (error) {
    console.error('Error:', error);
    showError(error.message);
  }
}

// Show error
function showError(message) {
  verdictBadge.className = 'badge bad';
  verdictBadge.textContent = 'Error';
  verdictText.textContent = message;
  scoreBar.style.width = '0%';
  scoreLabel.textContent = '—';
 
  contextText.textContent = 'Please try again or check your connection.';
  document.getElementById('xaiSection').style.display = 'none';
}

// Check button handler
const checkBtn = document.getElementById('checkBtn');
const clearBtn = document.getElementById('clearBtn');
const headline = document.getElementById('headline');

checkBtn.addEventListener('click', async () => {
  const isTextMode = tabText.classList.contains('active');

  if (isTextMode) {
    const text = headline.value.trim();
    if (!text) {
      showError('Please enter some text to verify');
      return;
    }

    checkBtn.disabled = true;
    checkBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Checking...';

    await verifyText(text);

    checkBtn.disabled = false;
    checkBtn.innerHTML = '<i class="fa-solid fa-magnifying-glass"></i> Check now';
  } else {
    if (!currentFile) {
      showError('Please upload an image first');
      return;
    }

    checkBtn.disabled = true;
    checkBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Checking...';

    await verifyImage(currentFile);

    checkBtn.disabled = false;
    checkBtn.innerHTML = '<i class="fa-solid fa-magnifying-glass"></i> Check now';
  }
});

// Clear button handler
clearBtn.addEventListener('click', () => {
  headline.value = '';
  currentFile = null;
  dz.innerHTML = '<i class="fa-solid fa-cloud-arrow-up"></i> Drop a screenshot or click to upload';
  
  verdictBadge.className = 'badge ok';
  verdictBadge.textContent = 'Ready';
  verdictText.textContent = 'Paste text or upload an image to get a verdict.';
  scoreBar.style.width = '0%';
  scoreLabel.textContent = '—';
  
  contextText.textContent = 'A short, human-friendly explanation appears here to make the verdict easy to act on.';
  document.getElementById('xaiSection').style.display = 'none';
});
</script>


</body>
</html>
